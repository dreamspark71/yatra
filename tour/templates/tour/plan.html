{% load staticfiles %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/rating.css' %}">
    <script src="{% static 'js/jquery.min.js' %}"></script>
    <script src="{% static 'js/bootstrap.min.js' %}"></script>
    <script src="{% static 'js/rating.js' %}"></script>
    <style>
        [contenteditable=true]:empty:not(:focus):before{
            content:attr(placeholder);.
    </style>
    <script>
        var editMode = {% if edit %}true{%else%}false{% endif %};
        var points = [
        ];
        var day = 1;

        function refresh(map) {
            {% for point in points %}
            addMarker(new google.maps.LatLng({{point.latitude}}, {{point.longitude}}), map, {{point.day}}, "{{point.description|safe|escape}}");
            {% endfor %}
        }

        var postUrl = "{% url 'plan' plan.pk %}";
    </script>

    <link href="{% static 'css/map.css' %}" type="text/css" rel="stylesheet"></link>
    <script src="{% static 'js/map.js' %}"></script>
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBg2Ixviw77H-z11vbBXn2SqBSbM3CAjS0&callback=initMap">
    </script>
</head>

<body>
    <div class="container">
        <h1>Plan</h1>
        <div class="row">
            <div class="col-md-4">
                {% if edit %}<div>
                <button id="post-plan">Save</button>
                </div>{% endif %}
                <strong><div id="title" {% if edit %} contenteditable="true" placeholder="Enter Title" {% endif %}>{{ plan.title }}</div></strong>
                <div>Rating: {{plan.rating}}</div>
                <div id="description" {% if edit %} contenteditable="true" placeholder="Enter Description" {% endif %}>{{ plan.description|safe }}</div>

                <hr>

                <div>
                    <ul id="trip-points">
                    </ul>
                </div>

                <hr>

                Share with ...

                <div>
                    Created By: {{plan.created_by}}

                </div>
            </div>
            <div class="col-md-8">
                <div id="floating-panel">
                    <input id="address" type="textbox" value="">
                    <input id="submit" type="button" value="Find in map">
                </div>
                <div class="row">
                    <div id="map" class="col-md-12" oncontextmenu="return false;"></div>
                </div>
            </div>
        </div>
        <div>
            Rating
            <div id="rate-container">
                <input type="radio" name="rating" class="rating" value="1" {% if review and review.rating == 1 %} checked {% endif %}/>
                <input type="radio" name="rating" class="rating" value="2" {% if review and review.rating == 2 %} checked {% endif %}/>
                <input type="radio" name="rating" class="rating" value="3" {% if review and review.rating == 3 %} checked {% endif %}/>
                <input type="radio" name="rating" class="rating" value="4" {% if review and review.rating == 4 %} checked {% endif %}/>
                <input type="radio" name="rating" class="rating" value="5" {% if review and review.rating == 5 %} checked {% endif %}/>
            </div>
            Review
            <textarea id="review">{% if review %}{{review}}{% endif %}</textarea>
            <button id="post-review">Post</button>
        </div>
    </div>

    <script>
        $("#rate-container").rating(function(vote, event) {
            data = {'vote': vote};
            $.redirectPost(
                postUrl,
                data
            );
        });
        $("#post-review").on('click', function() {
            data = {'review': $("#review").html()};
            $.redirectPost(
                postUrl,
                data
            );
        });
        $('[contenteditable]').keydown(function(e) {
            if ($(this).html().trim() == '<br>')
                $(this).html("");
        });

        $.extend(
        {
            redirectPost: function(location, args)
            {
                var form = "{% csrf_token %}";
                $.each( args, function( key, value ) {
                    form += '<textarea type="hidden" name="'+key+'">' + value + '</textarea>';
                });
                $('<form action="'+location+'" method="POST">'+form+'</form>').appendTo('body').submit();
            }
        });

    </script>
</body>
</html>
